services:
  am-document-processor-service:
    container_name: am-document-processor-service
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
        - .env
    environment:
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_BOOTSTRAP_SERVERS}
      MONGODB_URL: ${MONGODB_URL}
    
    entrypoint: ["/bin/sh", "-c"]
    command: 
      - |
        echo "=== AM Document Processor Service Environment Variables ==="
        echo "Database URL: ${MONGODB_URL}"
        echo "Kafka Servers: ${KAFKA_BOOTSTRAP_SERVERS}"
        echo "=== Starting AM Document Processor Service ==="
        java -jar app.jar
    ports:
      - "8070:8070"
    networks:
      - market-data-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 3s
      retries: ${AM_DOCUMENT_PROCESSOR_MAX_RETRIES}
    restart: unless-stopped

volumes:
  postgres_data:
  influxdb_data:
  grafana_data:

networks:
  market-data-network:
    driver: bridge
